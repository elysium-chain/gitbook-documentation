# ⛓ Statechain

## 为什么流行的区块链如此庞大？

比特币和以太坊等区块链中存储的信息大小目前分别超过430GB和580GB，并且以加速的速度持续增长。

问题在于，即使我们抛开安全问题，区块链也无法分割。毕竟，仅仅基于不包含所有交易的部分区块无法获得完整且一致的账务视图。

因此，每个连接到比特币或以太坊网络作为节点的新参与者都必须下载并处理所有区块和存储的交易，从创世区块开始。目前需要几天的时间，而随着时间的推移，情况将会恶化。

因此，随着时间推移，区块链中积累的信息越多，对新节点所有者的进入门槛就越高，可能对网络的去中心化构成严重威胁。

{% hint style="info" %}
流行的区块链中的信息正在以超过技术进展的速度积累，这意味着在可预见的未来，它将无法适应市场上最大的硬盘。因此，早晚只有拥有多台服务器的大型数据中心才能作为节点。
{% endhint %}

因此，至关重要的是以一种不会随着时间指数增加存储信息量的方式构建区块链账务。选择只有两种基本的账务模型之间。

#### 比特币：UTXO模型

比特币中的工作量证明共识创建了一个受保护的区块链，其中包含所有交易的日志。由于区块链必须记录所有交易，而交易的数量仅取决于用户活动，因此网络节点存储的数据量不仅随时间增长，而且没有增长的限制。

比特币账务是基于UTXO（未花费的交易输出）原则构建的，这意味着将一个尚未使用的交易结果作为另一个交易的输入。

换句话说，系统追踪的不是用户账户中的硬币数量，而是签署交易的人是否有权花费前一笔交易中剩余的比特币余额。

因此，用户可能有多个来自不同交易的硬币余额可供使用，并且每次都必须选择在给定交易中要使用的硬币。因此，每个比特币的流动可以追溯到发行时的时间。

在比特币中，UTXO与链接的区块和工作量证明共识相结合，因为UTXO跟踪的是交易而不是用户。但是，这种方法不允许对区块链的一部分进行归档，因为任何旧区块可能包含未使用的交易输出。

鉴于区块链的完整性，Satoshi Nakamoto在他的[白皮书](https://bitcoin.org/bitcoin.pdf)中提供了另一种方法来减少区块链中存储的信息量。他建议删除区块中旧交易的所有详细信息。

这种方法可以将区块链数据减少99%，但完全删除了所有历史记录。它只留下经过清理的区块链链条，可以进行正确性的交叉检查，但无法用于重建比特币的转账记录。

现在，这种经过清理的比特币UTXO数据只有5GB，轻量级节点用于数据验证。但即使只有一个币的5GB会计数据 - 没有智能合约或用户代币 - 也是非常庞大的。

此外，即使通过清除交易详细信息来减小UTXO数据的大小，由于硬币继续碎片化，清理的区块仍然占用空间，并且其数量只会增加。

#### 以太坊：账户模型

交易日志是维护总账的基本信息。但由于日志庞大且潜在无限，专业人员（会计师和税务检查员）通常在工作中使用不同类型的余额（资产负债表、试算表）。

这种方法允许将许多交易在账户的上下文中聚合，从而将数据大小限制在账户数量上，大大减少了数据量。

在区块链的上下文中，处理所有交易的结果余额是用户钱包列表，其中包含他们所拥有的硬币余额。

{% hint style="info" %}
可以将此类用户账户余额视为在不同区块和交易中收集所有UTXO的方式。我们将来将把这样的账户余额称为账户状态或状态。
{% endhint %}

而比特币主要是基于工作量证明共识，基于交易日志构建的，以太坊网络必须放弃UTXO概念以实现智能合约并使用账户状态（以太坊术语中的“世界状态”）。

然而，由于工作量证明共识的遗留问题，以太坊的账户状态是次要的，因为账本仍然基于区块链的链条，通过处理该链条中的每个区块，每个节点必须达到相同的最终世界状态。

实际上，在以太坊切换到具有

最终化能力的权益证明共识后，可以将区块链分割并将旧部分存档以供未来验证。这将会将存储的数据量减小到状态的大小。

然而，由于以太坊的世界状态包括不仅仅是钱包余额，还包括所有智能合约的数据，所以其体积目前已经超过130GB。而且这还不是极限，因为智能合约变得非常流行，它们的所有数据和代码都永久存储在区块链中。

{% hint style="info" %}
当然，存在许多解决这个问题的[提案](https://github.com/tvanepps/EthereumDiscordGuidebook/blob/main/state-expiry/README.md)，但它们都完全改变了我们所熟悉的智能合约的概念。
{% endhint %}

## Statechain

将交易历史作为真相的唯一来源形成区块链，主要是工作量证明共识和UTXO账务模型的遗留。

然而，如果账务基于账户模型，那么特定状态将与最终化的区块永久固定。毕竟，最终化的区块链形成了唯一的特定状态。

使用最终化的状态进行检查等于验证整个区块链。如果交易在最终化的区块中，大多数节点在此之前已经验证过。如果节点的程序出现错误，允许无效交易通过，使用标准方法重新处理区块将无法检测到错误。换句话说，大多数节点接受交易后检测到错误意味着软分叉。

{% hint style="info" %}
例如，比特币的编程错误导致某人创建了1840亿比特币。由于错误在程序算法中，所有节点都错过了这个错误，只能在事后通过手动分析交易历史才能发现。他们必须更新程序并回滚区块链的状态来修复问题。
{% endhint %}

因此，当新节点加入网络时，不再需要处理整个交易历史，而是需要一个最终化的账户状态。这将需要下载的数据大大减少，同时也不需要检查以前的所有交易在冗长的区块链中的情况。

区块将引用账户状态（而不是彼此）来在Elysium中实现这种方法。这将允许构建两个相应的序列：区块链和状态链。

{% hint style="info" %}
Statechain是区块链概念的扩展，因此在涉及Elysium时使用“区块链”一词是正确的。
{% endhint %}

尽管理论上伪造账户状态要比伪造冗长的区块链容易，但在具有即时最终化功能的情况下，这不会影响整个系统的安全性。

首先，使用普通计算机进行暴力破解仍然需要数十亿年来伪造一个状态。其次，即使一个极其幸运的攻击者生成了与原始状态相同的伪造状态，并设法将其传递给新加入的节点，欺诈行为将在下一个区块上显现出来。在处理交易后，状态将发生变化，并且大多数节点维护的更新的伪造状态的哈希值将与新的规范状态不匹配。

因此，在Elysium中，新加入的节点只需要获取由保管者一致同意的一对区块，以确保其中一个邻居发送了正确的账户状态。

与以太坊不同，Elysium不会存储用户代币的数据和逻辑，这将使其大小减小数个数量级。

{% hint style="info" %}
在开发过程中，确切的状态大小将会变得明确，但我们将尽力使其在拥有一百万用户时只有几兆字节的大小。
{% endhint %}

新成员连接到区块链所需的少量数据将使公共集群中的动态节点轮换成为可能，并且允许工作节点在家用计算机上运行区块链节点，即使有数百万活跃用户。

同时，添加状态链的概念不会破坏使用区块形成单个交易日志的初始思想。仍然可以从外部存储的链条上检查Elysium从开始到最后一个账户状态的整个历史。

## 总结

在Elysium中，由于动态轮换节点和需要在普通家用计算机上维护区块链的需要，新参与者的进入门槛比在那些可以连续运行数年并处理传入区块的服务器网络中更为关键。

通过使用状态链来扩展区块链概念，节点可以存储维护当前账务所需的最少信息，并且可以正确和可验证地进行维护。

同时，仍然可以在外部存储整个区块链存档，例如在IPFS上，以便任何人都可以通过从头开始重构来双重检查所有交易的完整历史记录。