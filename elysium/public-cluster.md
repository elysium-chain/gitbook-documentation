# 💠 公共集群

## 对等架构的兴衰

去中心化的概念相当广泛，涉及多个领域的各个方面，包括政治、社会学、博弈论、工程学、编程和经济学。因此，当我们描述一个计算机系统为去中心化时，我们必须强调我们所讨论的特定方面。通常，去中心化指的是一个由相等且可互换的节点组成的对等架构网络。

{% hint style="info" %}
纯粹的对等架构假设构成网络的节点为彼此提供服务。计算机程序允许用户从不同的节点获取资源，同时它还充当处理其他参与者请求的服务器。一个很好的类比是理发店协会，成员可以向其他人请求免费理发。
{% endhint %}

然而，并非所有的对等网络都是真正去中心化的系统，因为通常在对等网络之上还有运行着中心化的服务，以帮助节点彼此通信。因此，类似于BitTorrent、SETI@home或Skype的分布式系统实际上处于中心化和对等之间。

但是，所有现有的去中心化系统都是基于对等架构的，因为这是唯一可用的选择。问题在于，所有这些系统都继承了对等架构固有的弱点。

#### 对等概念的诞生

构建一个由相等节点组成的网络的想法源于个人电脑的迅速普及，这为个体用户带来了无限的自由。当时似乎普通用户可以通过联合和共享资源在没有大公司或国家这样的中央机构的情况下进行协作。

但是，对等概念的实际实现（1984年）直到其提出的20年后才成为可能。直到2000年代初，大多数用户才开始使用支持多任务处理的操作系统，而对等节点软件不会阻塞其余的功能，而且专用的互联网连接开始积极取代拨号连接。

#### 构建去中心化对等文件存储的失败尝试

第一个对等系统试图解决的主要任务是基于家庭计算机的分布式文件存储的实现。实际上，这种系统的基本限制立即变得明显。

事实证明，在纯粹的对等网络中，无法实现对存储在节点上的文件进行有效搜索。这是因为只有可以立即下载的文件才应该进行搜索。换句话说，在搜索时只应该查询那些在搜索时正在工作的节点。但是在一个去中心化的对等公共网络中，获取一个实时的工作节点列表是不现实的。

因此，唯一的搜索方式是将请求从一个节点传输到另一个节点。但是由于节点不断连接和断开网络，搜索请求将永远无法完成，因为系统中可用文件的列表正在不断变化。而且，请求寿命的限制降低了它达到所需文件存储的节点的概率。

{% hint style="info" %}
在非结构化对等网络中搜索文件可以类比为离开一个不断变化的迷宫。找到出口（如果有的话）的唯一方法是在随机漫步过程中有幸找到。这是分散网络中路由问题的一个方面。
{% endhint %}

#### 区块链——对等系统演进的新变化

除了构建文件存储外，还尝试创建用于分布式计算的对等系统。但是所有这样的项目（例如SETI@home）在其架构中都存在某种程度的中心化。

比特币是第一个真正去中心化的对等系统，它使用分布式计算来保护交易的权威历史。起初，这种方法运行良好，对等架构引起的瓶颈出现得相对较晚。

遇到的第一个问题是[IP地址耗尽](https://en.wikipedia.org/wiki/IPv4_address_exhaustion)。IPv4协议（1981年）仍占据大部分互联网流量，其地址数仅超过42亿个，远不及当前连接到互联网上的所有设备。

{% hint style="info" %}
大多数技术都是偶然和机遇的结果——根据文特·瑟夫的说法，互联网是从实验室中逃逸出来的实验。
{% endhint %}

普通用户并没有注意到IP地址的不足。但对于对等扩展来说，这是一个严重的限制，因为节点必须相互连接以形成网络。由于IP地址不足，大多数家用计算机通过[网络地址转换（NAT）](https://en.wikipedia.org/wiki/Network_address_translation)连接到互联网，这样就无法在没有具有公共IP地址的第三方服务器的帮助下直接互连。

第二个问题是交易数量的不断增长，因此区块链的大小也在不断增加。如今，比特币的区块链超过了430GB，因此要

下载所有的区块并验证链的完整性需要数天时间，这对于初始启动节点来说是不可行的。

庞大的区块链大小对于新用户来说构成了高门槛，因为对等架构意味着与系统的任何交互，甚至是发起自己的交易，都需要拥有个人节点。

第三个问题是比特币价格的指数增长，导致参与发行的竞争变得非常激烈。矿工之间的竞争变得如此激烈，以至于使用普通计算机创建新块并因此获得奖励的概率几乎为零。

{% hint style="info" %}
如今，大部分新块都是由专门设计的设备（ASIC）构建的大型矿场生成的。其中最大的矿场属于ASIC制造商自己。因此，大型参与者已经掌握了比特币发行权，使其远离最初的对等想法。
{% endhint %}

因此，几乎不可能在家用计算机上运行比特币节点的功能。

为了解决这些问题，节点被分为不同类型，以解决这些问题。_矿工_是专门为块生成而设计的矿场的特殊客户端。_轻节点_充当普通用户的钱包。_全节点_是服务器的类比，扮演验证者、数据库存储和网络网关的角色。

根据任务将节点分成不同类型可以解决比特币中累积的大部分问题。但它也打破了最初的逻辑——全节点在网络中的贡献最大，尽管它们没有获得奖励。

#### 对等的衰落

将节点分成不同类型不仅适用于比特币——几乎所有现代区块链的开发人员都在其架构中构建了多种类型的节点，这使得区块链技术越来越远离节点的平等和可互换性。

因此，我们现在可以自信地宣布纯粹的对等方法的失败。此外，许多中心化的解决方案似乎如此自然，以至于我们甚至没有注意到它们的存在。例如，当您通过MetaMask将交易发送到区块链、在区块链浏览器中分析交易或将文件上传到IPFS时，您正在使用客户端-服务器方法——对等的对立面。

这并不是一件坏事，因为真正重要的不是计算机之间的技术交互原则，而是独立于设定自己规则的监管机构的想法，这正是对等概念所象征的。

坏的是，在公平的一面，没有其他可以替代古老的对等架构，它在40年的发展中并未克服其固有的限制。

是时候发明一些新的东西了，特别是区块链技术已经开启了新的视野。

## 公共集群

尽管去中心化计算机系统的概念被视为对等架构的同义词，但它们并不完全相同。虽然对等是系统构建的原则，但去中心化是它所拥有的一组属性。我们认为没有控制系统关键基础设施的所有者是这些属性中最重要的。

{% hint style="info" %}
所有者可以决定哪个服务器提供当前时间、保持所有工作节点列表或存储文件路径。但这样的服务器会为所有人所知，如果第三方阻止它，系统将停止工作。这种情况已经发生了多次。
{% endhint %}

理论上，节点关于系统状态的大多数共识可以作为事实来源。参与者的个体利益是相互矛盾的，结果是系统将追求大多数参与者利益的平衡。

在实践中，攻击者可以通过创建节点来控制系统中的多个节点，从而获得多

节点的优势，并将共识偏向自己的利益。这种私有化攻击系统中没有所有者的威胁被称为Sybil攻击。

防御这种攻击的主要方法是参与者之间对有限资源的竞争。这种方法首次在比特币网络中使用，其中对块链的规范交易历史进行投票与参与者控制的节点数量无关，而是涉及计算资源，这不仅需要初始投资，还需要持续消耗电力。

因此，工作量证明共识主要是基于防范Sybil攻击的保护机制。而权益证明也是如此，它使用存储在区块链中的代币而不是计算来进行共识。

{% hint style="info" %}
从比特币开始，所有后来真正去中心化的区块链都使用内置的防范Sybil攻击的共识，因为只有这种方法才允许使用对等架构。
{% endhint %}

但是，保护系统免受Sybil攻击的机制可以与共识机制分开，通过将安全圈外移到系统之外。只有在参与者之间必须相互竞争才能加入系统时，攻击者才能破解“一个节点-一个投票”的公式。如果参与者必须与彼此竞争才能加入系统，那么Sybil攻击的威胁将在共识过程之前被消除。

此外，保护网络免受虚假节点的影响还可以使我们摆脱对等架构，同时保持无所有者的概念。毕竟，通过发行区块链资产来激励节点对网络的参与极大地影响了网络的规模和配置。

迄今为止，此属性仅被应用于在广度上扩展平坦对等网络的动机。我们建议利用有限的区块链资源来构建节点的深度层次结构。

换句话说，区块链概念带来的有限虚拟资产不仅可以用于创建加密货币，还可以用作构建层次结构的手段。

这种方法通过添加新的复杂性维度到去中心化系统的架构中，使其能够通过分工的方式大幅提高效率，这是纯对等架构所无法实现的。

我们将这种类型的架构称为公共集群。

> **公共集群是一种无所有者系统的架构，由垂直链接的分层组成，参与其中需要使用有限的区块链资源。每个层次都由相等和可互换的节点组成，可以看作是一个独立的对等网络。**

在经典工作量证明中，真实的计算能力保护着虚拟区块链免受篡改。而在公共集群架构中，虚拟区块链资源保护着物理网络免受虚假节点的伤害。

{% hint style="info" %}
将区块链视为一根绳子，当织入工作量证明共识时，节点将其中一根金色线纳入其中。而在公共集群中，节点需付出虚拟黄金作为参与设备的代价，从而产生一根具有独特颜色的绳子。
{% endhint %}

公共集群架构具有一整套独特的优势：

* 无所有者设计。没有政治风险，这意味着没有参与者可以为了自己的利益更改系统规则，因此不存在单点故障，比如某个特定的个人或公司可以被第三方推动。
* 去中心化的真实来源。节点达成共识的更高层次上的信息可以成为更低层次上的单一事实来源，防止攻击者误导其他参与者。换句话说，单一所有者被由多个节点组成的去中心化层次结构所取代。它为解决BFT问题提供了全新的可能性。例如，首次可以通过在分层结构的一层上构建结构化拓扑来实现去中心化系统中节点之间的单播转发消息。
* 无需许可的系统。任何（但不是每个）用户都可以在层次结构的一个层次上运行自己的节点，无需经过授权中心（实际上不存在）。同时，最低层可能不需要资源来参与，从而使任何人都可以支持该系统。
* 共识简化。当不需要将防范Sybil攻击内置到共识机制中时，可以使用多个独立参数来选择下一个块。此外，在最高层-最安全的层次上由有限数量的节点达成块一致性，可以确保去中心化、安全和快速的共识。
* 高效性。公共集群的层次结构允许顺序信息处理，即按照传送带原则。例如，如果预处理在一个层次结构中生成来自交易的块作为区块链状态的补丁和zk-SNARK，那么另一个层次结构将几乎即时更新数据。从理论上讲，这使得去中心化系统能够超越单个服务器的信息处理

能力，并提供更高的吞吐量和更低的延迟。

公共集群是对等架构的演进，它通过层次结构和有限资源的使用提供了更高的效率、更好的安全性和更大的灵活性。这种架构可以应用于各种去中心化系统，包括区块链、文件存储和分布式计算。它为无所有者系统提供了一种全新的设计方式，使参与者能够以相等和可互换的方式参与，并在共享资源的基础上达成共识。

然而，需要注意的是，公共集群架构仍然处于研究和发展阶段，目前尚未广泛应用于实际系统。将来，随着技术的进一步发展和实践的验证，公共集群架构可能会成为构建可扩展、安全和高效的去中心化系统的重要工具之一。